# dakota-grammar-translation

> Single-turn and multi-turn Dakota grammar tasks grounded in the 1890 Dakota-English Dictionary grammar rules.

### Overview
- **Environment ID**: `dakota-grammar-translation`
- **Short description**: Evaluate and fine-tune models on Dakota grammar tasks including morphology, translation, and pattern identification with rule-aware scoring.
- **Tags**: dakota, translation, grammar, rl, eval, morphology

### Datasets
- **Primary dataset(s)**: `dakota_rl_training/datasets/grammar_tasks_complete.jsonl` generated by the grammar-to-RL pipeline.
- **Source links**: [Dakota1890 Repo](https://github.com/HarleyCoops/Dakota1890)
- **Split sizes**: Defaults to 90/10 train/eval split with curriculum splits (easy/medium/hard).

### Task
- **Type**: Single-turn and multi-turn chat
- **Parser**: `DakotaTranslationParser` (preserves Dakota orthography)
- **Rubric overview**: Character preservation, affix accuracy, semantic correctness, and pattern-based rule coverage metrics.

### Quickstart
Run an evaluation with default settings:

```bash
uv run vf-eval dakota-grammar-translation
```

Configure model and sampling:

```bash
uv run vf-eval dakota-grammar-translation \
  -m gpt-4.1-mini \
  -n 20 -T 0.7 -M 1024 \
  -a '{"dataset_path": "dakota_rl_training/datasets/grammar_tasks_complete.jsonl", "max_examples": 200}'
```

### Environment Arguments

| Arg | Type | Default | Description |
| --- | ---- | ------- | ----------- |
| `dataset_path` | str | `<repo>/dakota_rl_training/datasets/grammar_tasks_complete.jsonl` | Source RL task JSONL file. |
| `eval_path` | str | `None` | Optional separate evaluation JSONL. |
| `max_examples` | int | `-1` | Cap number of training examples. |
| `eval_examples` | int | `-1` | Cap number of evaluation examples. |
| `eval_fraction` | float | `0.1` | Fraction reserved for eval when `eval_path` not supplied. |
| `difficulty_filter` | list[str] | `None` | Filter dataset to specific difficulty labels (easy/medium/hard). |
| `task_filter` | list[str] | `None` | Filter dataset to specific task types (morphology/translation/etc). |
| `system_prompt` | str | "You are a Dakota language expert..." | Custom system instruction. |

### Metrics

| Metric | Meaning |
| ------ | ------- |
| `character_preservation_reward` | Reward for preserving Dakota special characters (ć, š, ŋ, etc.) |
| `affix_accuracy_reward` | Reward for correct affix application (prefixes/suffixes) |
| `semantic_accuracy_reward` | Reward for semantic correctness (translation quality) |
| `composite_reward` | Weighted combination of all metrics |

### Dakota Special Characters

The environment enforces preservation of Dakota orthography:
- **Glottal stop**: ʼ
- **Acute accents**: á, é, í, ó, ú
- **Caron diacritics**: č, š, ž
- **Special consonants**: ŋ (eng)
- **Dotted characters**: ḣ, ṡ, ė

These characters are critical for accurate Dakota language representation.

